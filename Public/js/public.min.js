$(".js-follow").click(function(){if($(this).text()=='取消关注'){$(this).text('关注话题');$(this).removeClass('am-btn-success');$(this).addClass('am-btn-default')}else{$(this).text('取消关注');$(this).removeClass('am-btn-default');$(this).addClass('am-btn-success')}});function load_form_conf(){$("#put-question-form").submit(function(e){e.preventDefault();var a=/\{\:(.+?)\!\}/;var b=a.exec($("#put-question-content").val());console.log(b);var c=/是哪部作品/;var d=c.exec($("#put-question-title").val());if(d&&b)$('#stu-confirm').modal('open');else{$("#put-question-form").submit(function(e){event.preventDefault()}).off('submit').submit(function(){console.log("submit unlock")});$("#put-question-form").submit()}})}function logout(){$.ajax({type:"GET",url:"/index.php/User/Operation/logout.html",complete:function(a){location.reload()}})}function notifyMode(a,b,c){this.icon=a;this.cls=b;this.tit=c}const LEFT=0;const RIGHT=1;const LOADING=new notifyMode('am-icon-spinner am-icon-spin','am-alert-success','Loading');const SUCCESS=new notifyMode('am-icon-info-circle','am-alert-success','Success');const ERROR=new notifyMode('am-icon-warning','am-alert-danger','Error');const INFO=new notifyMode('am-icon-info-circle','am-alert-secondary','Infomation');function notify(a,b,c){new PNotify({title:b.tit,text:a,icon:b.icon,addclass:(c?'':'stack-topleft ')+b.cls,buttons:{closer:false,sticker:false}})}function loading_notify(){notify('正在提交...',LOADING,LEFT)}function success_notify(a){notify(a,SUCCESS,LEFT)}function info_notify(a){notify(a,INFO,LEFT)}function error_notify(a){notify(a,ERROR,LEFT)}function success_notify_right(a){notify(a,SUCCESS,RIGHT)}function info_notify_right(a){notify(a,INFO,RIGHT)}function error_notify_right(a){notify(a,ERROR,RIGHT)}function login(c){$.ajax({type:"POST",url:"/index.php/User/Operation/login.html",data:{user:$("#username").val(),pass:$("#password").val(),remember_me:$("#remember-me").val()},success:function(a){var b=JSON.parse(a);if(b['info']=="Success"){success_notify("登录成功，正在跳转");if(c=='NULL')window.location.href='/';else window.location.href=c}else{console.log(a);error_notify(b['error'])}}})}function register(c){$.ajax({type:"POST",url:"/index.php/User/Operation/register.html",data:{username:$("#username").val(),password:$("#password").val(),email:$("#email").val(),},success:function(a){var b=JSON.parse(a);if(b['info']=="Success"){success_notify("注册成功，自动登录完毕，正在跳转");if(c=='NULL')window.location.href='/';else window.location.href=c}else{console.log(a);error_notify(b['error'])}}})}function upload(f){if(f=="question")$('#put-question-upload').modal('close');$('#put-question-uploading').modal('open');$.ajaxFileUpload({url:"/index.php/Home/Question/upload.html",secureuri:false,fileElementId:'put-question-upload-input',dataType:'text',success:function(a,b){$('#put-question-uploading').modal('close');var c=/error\">(.*)<\/p>/;var d=c.exec(a);if(d){alert(d[1]);if(f=="question")$('#put-question-upload').modal('open')}else{if(f=="question"){$("#put-question-content").val($("#put-question-content").val()+"![img](/Public/Uploads/"+a+")");$('#put-question-popup').modal('open')}else if(f=="answer"){$("#put-answer-content").val($("#put-answer-content").val()+"![img](/Public/Uploads/"+a+")");$('#put-question-upload').modal('close')}}},error:function(a,b,e){error_notify(e)},})}function on_continue_put_question_btn_click(){$("#put-question-form").submit(function(e){event.preventDefault()}).off('submit').submit(function(){console.log("submit unlock")});$("#put-question-form").submit()}function comment_toggle(a,b){$("#comment-"+$(a).attr('value')).toggle();$("#div-comment-"+$(a).attr('value')).load('/index.php/Home/Question/get_comment.html?id='+$(a).attr('value')+'&mode='+b);console.log('/index.php/Home/Question/get_comment.html?id='+$(a).attr('value')+'&mode='+b)}function put_comment(b,c){$.ajax({type:"POST",url:"/index.php/Home/Question/put_comment.html",data:{id:b,content:$("#put-comment-content-"+b).val(),mode:c},success:function(a){if(a=="1"){$("#div-comment-"+b).load('/index.php/Home/Question/get_comment.html?id='+b+'&mode='+c)}else{error_notify('评论失败')}}})}function agree_answer(d,e){if(getCookie('mgqa_username')=="")$.ajax({type:"GET",url:"/index.php/Home/Question/agree?answer_id="+d+"&agree="+e,success:function(a){if(a=="-1"){error_notify('失败，发生错误')}else if(a=="-2"){error_notify('不要赞自己噢~')}else{$("#answer-agree-numb-"+d).text(a);var b="";var c="";if(e==1){b="#agree-answer-btn-"+d;c="#unagree-answer-btn-"+d}else{b="#unagree-answer-btn-"+d;c="#agree-answer-btn-"+d}if($(b).hasClass("am-btn-primary"))$(b).removeClass("am-btn-primary");else{$(b).addClass("am-btn-primary");$(c).removeClass("am-btn-primary")}}}})}function on_follow_topic_btn_click(c,d){$.ajax({type:"GET",url:"/index.php/Home/Topic/set_follow_topic.html?topic_id="+c,success:function(a){var b=JSON.parse(a);if(b['status']){success_notify_right('<strong>'+d+'</strong> '+b['info'])}else{error_notify_right(b['error'])}}})}function getCookie(a){var b=document.cookie;var c=b.split("; ");for(var i=0;i<c.length;i++){var d=c[i].split("=");if(a==d[0]){return d[1]}}return""}function follow_user(b,c){$.ajax({type:"POST",url:"/Home/User/follow.html",dataType:"json",data:{toname:c},success:function(a){console.log(a);if(a.error)error_notify(a.error);else{if(a.relation==0){$('.follow-btn-'+c).addClass('am-btn-success');$('.follow-btn-'+c).removeClass('am-icon-retweet');$('.follow-btn-'+c).text("关注TA")}else if(a.relation==1){$('.follow-btn-'+c).removeClass('am-icon-retweet');if(b>c){$('.follow-btn-'+c).removeClass('am-btn-success');$('.follow-btn-'+c).text("取消关注")}else{$('.follow-btn-'+c).addClass('am-btn-success');$('.follow-btn-'+c).text("关注TA")}}else if(a.relation==2){$('.follow-btn-'+c).removeClass('am-icon-retweet');if(b>c){$('.follow-btn-'+c).addClass('am-btn-success');$('.follow-btn-'+c).text("关注TA")}else{$('.follow-btn-'+c).removeClass('am-btn-success');$('.follow-btn-'+c).text("取消关注")}}else{$('.follow-btn-'+c).removeClass('am-btn-success');$('.follow-btn-'+c).addClass('am-icon-retweet');$('.follow-btn-'+c).text(' 取消关注')}}}})}function push2timeline(b,c,d){$.ajax({type:"GET",url:"/index.php/Home/Question/push2timeline.html?mode="+b+"&project_id="+c,success:function(a){$(d).text("已推送");$(d).addClass("am-disabled")}})}function get_info(){if(!$('#topbar-info').hasClass('am-active'))return;$.ajax({type:"GET",url:"/index.php/Home/index/update_time.html"});$('#info_question').load('/index.php/Home/index/get_question.html');$('#info_follow').load('/index.php/Home/index/get_follow.html');$('#info_agree').load('/index.php/Home/index/get_agree.html')}